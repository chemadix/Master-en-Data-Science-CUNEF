"0","nv    = ncol(Y) # Number of variables"
"0","nf    = 12      # Periods to forecast"
"0","nb    = 16      # Periods of back data to plot, used later"
"0"," "
"0","v     = crossprod(Y - X %*% bhat)/(nrow(Y) - m * nv - 1)                 # Calculate error variance"
"0","bhat2 = bhat[rep(seq(1, m * nv, m), m) + rep(seq(0, m - 1), each = nv),] # Reorder for simulation"
"0","A     = rbind(t(bhat2), diag(1, nv * (m - 1), nv * m))                   # First order form - A "
"0","B     = diag(1,nv*m,nv)                                                  # First order form - B"
"0","cnst  = c(t(tail(bhat,1)), rep(0,nv * (m - 1)))                          # First order constants"
"0","# Simulation loop"
"0","Yf     = matrix(0, nv * m, nf + 1)                # Stores forecasts"
"0","Yf[,1] = c(t(tail(Y, m)[m:1,]))                   # Lagged data"
"0","Pf     = matrix(0, nv, nf + 1)                    # Stores variances"
"0","P      = matrix(0, nv * m, nv * m)                # First period state covariance"
"0"," "
"0","for (k in 1:nf) { "
"0","  Yf[, k + 1] = cnst + A %*% Yf[,k]"
"0","  P = A %*% P %*% t(A) + B %*% v %*% t(B)"
"0","  Pf[, k + 1] = diag(P)[1:nv]"
"0","}"
